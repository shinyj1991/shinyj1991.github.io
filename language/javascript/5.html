<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1">
    <title>[Javascript] fetch와 Cross-Origin 요청</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  </head>
  <body>
    <div id="wrap">
      <header id="header">
        <h1 class="logo"><a href="/">SIMPLIZM</a></h1>
        <button class="btn-menu-toggle" onclick="$('body').toggleClass('open-gnb');"><span>전체메뉴</span></button>
        <nav class="gnb">
          <ul>
            <!--  -->
            
            
              
              
              
              
                
                
                
                
                <li><a href="/category/Language">Language
                  
                  <span class="count">(13)</span>
                </a>
                  
                  <ul>
                    
                    <li>
                      <a href="/category/Java/">Java
                        
                        <span>(6)</span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="/category/Javascript/">Javascript
                        
                        <span>(7)</span>
                      </a>
                    </li>
                    
                  </ul>
                  
                </li>
              
            
              
              
              
              
            
              
              
              
              
                
                
                
                
                <li><a href="/category/Library">Library
                  
                  <span class="count">(16)</span>
                </a>
                  
                  <ul>
                    
                    <li>
                      <a href="/category/Etc/">Etc
                        
                        <span>(1)</span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="/category/React/">React
                        
                        <span>(15)</span>
                      </a>
                    </li>
                    
                  </ul>
                  
                </li>
              
            
              
              
              
              
            
              
              
              
              
            
              
              
              
              
                
                
                
                
                <li><a href="/category/Framework">Framework
                  
                  <span class="count">(6)</span>
                </a>
                  
                  <ul>
                    
                    <li>
                      <a href="/category/Codeigniter/">Codeigniter
                        
                        <span>(1)</span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="/category/Next.js/">Next.js
                        
                        <span>(5)</span>
                      </a>
                    </li>
                    
                  </ul>
                  
                </li>
              
            
              
              
              
              
            
              
              
              
              
            
              
              
              
              
                
                
                
                
                <li><a href="/category/Web Standards">Web Standards
                  
                  <span class="count">(1)</span>
                </a>
                  
                </li>
              
            
              
              
              
              
            
          </ul>
        </nav>
      </header>

      <main id="container">
        <article class="post-wrap">
  <aside id="post-aside" class="post-aside">
    <div class="toc-outer">
      <ul>
        <li>
          <a href="#[Javascript] fetch와 Cross-Origin 요청">[Javascript] fetch와 Cross-Origin 요청</a>
          <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#안전한-요청">안전한 요청</a></li>
<li class="toc-entry toc-h2"><a href="#안전하지-않은-요청">안전하지 않은 요청</a></li>
</ul>
        </li>
      </ul>
    </div>
  </aside>
  <div id="post-content" class="post-content">
    <div class="post-head">
      <h1 id="[Javascript] fetch와 Cross-Origin 요청">[Javascript] fetch와 Cross-Origin 요청</h1>
    </div>
    <div class="post-meta">
      <div>
        2021-02-03 10:57
        ShinyJ
      </div>
    </div>
    <div id="post-body" class="post-body"><p>브라우저 관점에선 크로스 오리진 요청은 안전한(safe) 크로스 오리진 요청과 그렇지 않은 크로스 오리진 요청 두 분류로 나뉩니다.</p>

<h2 id="안전한-요청">안전한 요청</h2>

<p>안전한 요청은 다음 조건을 모두 충족하는 요청입니다.</p>

<ul>
  <li>메서드: GET이나 POST 혹은 HEAD</li>
  <li>헤더:
    <ul>
      <li>Accept</li>
      <li>Accept-Language</li>
      <li>Content-Language</li>
      <li>값이 application/x-www-form-urlencoded 나 multipart/form-data, text/plain인 Content-Type</li>
    </ul>
  </li>
</ul>

<p>안전한 요청은 아주 오래전 부터 &lt;form&gt;이나 &lt;script&gt; 태그를 사용해도 가능했던 요청인 반면 안전하지 않은 요청은 브라우저에선 보낼 수 없었던 요청이라는 점이 두 요청의 근본적인 차이입니다.</p>

<p>실무 관점에서 두 요청의 차이는 안전한 요청은 Origin 헤더와 함께 바로 요청이 전송되는 반면 안전하지 않은 요청은 브라우저에서 본 요청이 이뤄지기 전에 <em>preflight</em> 요청이라 불리는 사전 요청을 보내 <em>퍼미션</em> 여부를 물어본다는 점입니다.</p>

<p><em>안전한 요청</em>은 다음과 같은 절차를 따릅니다.</p>

<ul>
  <li>→ 오리진 정보가 담긴 Origin 헤더와 함께 브라우저가 요청을 보냅니다.</li>
  <li>← 자격 증명이 없는 요청의 경우(기본), 서버는 아래와 같은 응답을 보냅니다.
    <ul>
      <li>Origin 값과 동일하거나 *인 Access-Control-Allow-Origin</li>
    </ul>
  </li>
  <li>← 자격 증명이 있는 요청의 경우 서버는 아래와 같은 응답을 보냅니다.
    <ul>
      <li>Origin 값과 동일한 Access-Control-Allow-Origin</li>
      <li>값이 true 인 Access-Control-Allow-Credentials</li>
    </ul>
  </li>
</ul>

<p>자바스크립트를 사용해 Cache-Control 이나 Content-Language, Content-Type, Expires, Last-Modified, Pragma 를 제외한 응답 헤더에 접근하려면 응답 헤더의 Access-Control-Expose-Headers 에 접근을 허용하는 헤더가 명시돼 있어야 합니다.</p>

<h2 id="안전하지-않은-요청">안전하지 않은 요청</h2>

<p>안전하지 않은 요청의 절차는 다음과 같습니다. 사전 요청인 ‘preflight’ 요청이 본 요청 전에 전송됩니다.</p>

<ul>
  <li>→ 브라우저는 동일한 URL에 OPTIONS 메서드를 사용한 preflight 요청을 보내게 되는데, 이때 헤더엔 다음과 같은 정보가 들어갑니다.
    <ul>
      <li>Access-Control-Request-Method : 본 요청의 메서드 정보가 담김</li>
      <li>Access-Control-Request-Headers : 본 요청의 헤더 정보가 담김</li>
    </ul>
  </li>
  <li>← 서버는 상태 코드 200과 아래와 같은 헤더를 담은 응답을 전송합니다.
    <ul>
      <li>Access-Control-Allow-Methods – 허용되는 메서드 목록이 담김</li>
      <li>Access-Control-Allow-Headers – 허용되는 헤더 목록이 담김</li>
      <li>Access-Control-Max-Age – 몇 초간 preflight 요청 없이 크로스 오리진 요청을 바로 보낼지에 대한 정보가 담김</li>
    </ul>
  </li>
  <li>이후엔 본 요청이 전송되고, 절차는 ‘안전한’ 요청과 동일합니다.</li>
</ul>

<p>출처 : <a href="https://ko.javascript.info/fetch-crossorigin" target="_blank">https://ko.javascript.info/fetch-crossorigin</a></p>
</div>
  </div>
</article>

<!-- DISQUS 광고가 개쩔어서 주석처리
<div id="disqus_thread"></div>
<script>
    var disqus_config = function() {
      this.page.url = 'https://shinyj1991.github.io/language/javascript/5';
      this.page.identifier = '/language/javascript/5';
    };

    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://simplizm.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->

<script>
  let arrHeaderPos = [];
  let arrHeaderId = [];

  const getHeaderAttr = () => {
    arrHeaderPos = [];
    arrHeaderId = [];

    $('#post-content :header').each(function (i, o) {
      arrHeaderPos.push(o.offsetTop - 10);
      arrHeaderId.push(o.id);
    });

    arrHeaderPos.push(999999);
    arrHeaderId.push('');
  }

  const resizeObserver = new ResizeObserver(entries => {
    getHeaderAttr();
  });

  resizeObserver.observe(document.body);

  $(document).ready(() => {
    getHeaderAttr();
  });

  $(window).on('load scroll', function () {
    for (let i = 0; i < arrHeaderPos.length; i++) {
      if (window.scrollY < arrHeaderPos[i]) {
        $('#post-aside').find('a').removeClass('active');
        if (arrHeaderId[i - 1]) {
          $(`a[href="#${arrHeaderId[i - 1]}"]`).addClass('active').focus();
        }
        break;
      }
    }
  });
</script>
      </main>

      <footer id="footer">
        <ul class="sns">
          <li><a href="https://github.com/shinyj1991" target="_blank">Github</a></li>
          <li><a href="https://www.instagram.com/shinyj_/" target="_blank">Instagram</a></li>
          <li><a href="https://simplizm.tistory.com/" target="_blank">Tistory</a></li>
        </ul>
        <p class="copyright">&copy; 2020. ShinyJ. Powered by Jekyll.</p>
      </footer>
    </div>
  </body>
</html>